{"2965": {"body": "This might work: https://stackoverflow.com/a/37702441/28465", "fixed_time": "2017-10-27T17:49:21", "label": [2], "files": ["android/guava/pom.xml", "guava/javadoc-link/j2objc-annotations/package-list", "guava/javadoc-link/jsr305/package-list", "guava/pom.xml"], "title": "Fix Javadoc links to javadoc.io"}, "2658": {"body": "A MinMaxPriorityQueue fails at removing the correct object after a series of operations. See output and code below.\r\n\r\n> [5.6, 6.0, 5.7, 5.9]\r\nTry to remove 5.7 :\r\n[5.6, 6.0, 5.7]\r\n\r\nObtained from :\r\n\r\n> MinMaxPriorityQueue<Double> values = MinMaxPriorityQueue.create();\r\n\t\t\tvalues.add(6.2);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(6.1);\r\n\t\t\tvalues.add(6.2);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.3);\r\n\t\t\tvalues.add(6.1);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.1);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.7);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.5);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.2);\r\n\t\t\tvalues.add(6.3);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.5);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.5);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.2);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.0);\r\n\t\t\tvalues.remove(6.2);\r\n\t\t\tvalues.add(5.7);\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.add(5.7);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(6.0);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.3);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.1);\r\n\t\t\tvalues.add(6.4);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(6.4);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.remove(6.3);\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.remove(5.8);\r\n\t\t\tvalues.add(6.4);\r\n\t\t\tvalues.remove(6.0);\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.3);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(6.3);\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.5);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.4);\r\n\t\t\tvalues.remove(5.4);\r\n\t\t\tvalues.add(5.7);\r\n\t\t\tvalues.remove(6.1);\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.add(5.4);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.remove(5.5);\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.8);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.remove(5.8);\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.add(6.0);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.7);\r\n\t\t\tvalues.add(6.0);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.remove(5.7);\r\n\t\t\tvalues.add(6.1);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(5.9);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.1);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(6.1);\r\n\t\t\tvalues.add(6.1);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.remove(6.1);\r\n\t\t\tvalues.add(6.0);\r\n\t\t\tvalues.add(6.0);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.remove(6.0);\r\n\t\t\tvalues.add(5.9);\r\n\t\t\tvalues.remove(6.0);\r\n\t\t\tvalues.add(5.7);\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tvalues.add(6.1);\r\n\t\t\tvalues.pollFirst();\r\n\t\t\tvalues.add(5.6);\r\n\t\t\tvalues.pollLast();\r\n\t\t\tSystem.out.println(values);\r\n\t\t\tSystem.out.println(\"Try to remove 5.7 :\");\r\n\t\t\tvalues.remove(5.7);\r\n\t\t\tSystem.out.println(values);", "fixed_time": "2016-11-30T17:35:11", "label": [1], "files": ["cycle_whitelist.txt", "guava-gwt/test/com/google/common/collect/MinMaxPriorityQueueTest_gwt.java", "guava-tests/test/com/google/common/collect/MinMaxPriorityQueueTest.java", "guava/src/com/google/common/collect/MinMaxPriorityQueue.java"], "title": "remove() in MinMaxPriorityQueue<Double> not removing the correct object"}, "339": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=339) created by **marsh.yeoman** on 2010-03-12 at 04:43 PM_\n\n---\n\nMultiple concurrent reads of HashMultimap result in null pointer exception.\n\nUsing Google collections version 1.0\n\nProblem\ncom.google.common.collect.AbstractMultimap.AsMap.entrySet()\ncan return null when called by multiple threads.\n\n1311    @\ufeffOverride public Set&lt;Map.Entry&lt;K, Collection&lt;V>>> entrySet() {\n1312      Set&lt;Map.Entry&lt;K, Collection&lt;V>>> result = entrySet;\n1313      return (entrySet == null) ? entrySet = new AsMapEntries() : result;\n1314    }\n1. thread 1 executes line 1312\n2. thread 2 executes 1312 and 1313\n3. thread 1 executes 1313.\n\nThread 1 will return null.\n\nFix by\n1313      return (result == null) ? entrySet = new AsMapEntries() : result;\n", "fixed_time": "2014-10-31T18:55:50", "label": [1], "files": ["guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/AbstractMapBasedMultimap.java", "guava-gwt/src-super/com/google/common/primitives/super/com/google/common/primitives/Doubles.java", "guava-gwt/src-super/com/google/common/primitives/super/com/google/common/primitives/Floats.java", "guava-gwt/src-super/com/google/common/primitives/super/com/google/common/primitives/Ints.java", "guava-gwt/src-super/com/google/common/primitives/super/com/google/common/primitives/Shorts.java", "guava-testlib/src/com/google/common/collect/testing/google/MultisetNavigationTester.java", "guava-testlib/src/com/google/common/testing/ArbitraryInstances.java", "guava-testlib/test/com/google/common/testing/NullPointerTesterTest.java", "guava-testlib/test/com/google/common/testing/SerializableTesterTest.java", "guava-tests/benchmark/com/google/common/util/concurrent/CycleDetectingLockFactoryBenchmark.java", "guava-tests/test/com/google/common/base/CharMatcherTest.java", "guava-tests/test/com/google/common/cache/CacheEvictionTest.java", "guava-tests/test/com/google/common/cache/CacheExpirationTest.java", "guava-tests/test/com/google/common/cache/EmptyCachesTest.java", "guava-tests/test/com/google/common/collect/ComputingConcurrentHashMapTest.java", "guava-tests/test/com/google/common/collect/MinMaxPriorityQueueTest.java", "guava-tests/test/com/google/common/collect/TreeRangeMapTest.java", "guava-tests/test/com/google/common/escape/UnicodeEscaperTest.java", "guava-tests/test/com/google/common/reflect/ElementTest.java", "guava-tests/test/com/google/common/reflect/InvokableTest.java", "guava-tests/test/com/google/common/reflect/ParameterTest.java", "guava-tests/test/com/google/common/util/concurrent/AbstractFutureTest.java", "guava-tests/test/com/google/common/util/concurrent/MonitorTestCase.java", "guava-tests/test/com/google/common/util/concurrent/TrustedListenableFutureTaskTest.java", "guava/src/com/google/common/base/Absent.java", "guava/src/com/google/common/base/Converter.java", "guava/src/com/google/common/base/Equivalence.java", "guava/src/com/google/common/collect/AbstractMapBasedMultiset.java", "guava/src/com/google/common/collect/AllEqualOrdering.java", "guava/src/com/google/common/collect/Cut.java", "guava/src/com/google/common/collect/DiscreteDomain.java", "guava/src/com/google/common/collect/EmptyImmutableListMultimap.java", "guava/src/com/google/common/collect/EmptyImmutableSetMultimap.java", "guava/src/com/google/common/collect/ImmutableAsList.java", "guava/src/com/google/common/collect/ImmutableList.java", "guava/src/com/google/common/collect/ImmutableSortedSet.java", "guava/src/com/google/common/collect/NaturalOrdering.java", "guava/src/com/google/common/collect/ReverseNaturalOrdering.java", "guava/src/com/google/common/collect/UsingToStringOrdering.java", "guava/src/com/google/common/primitives/Doubles.java", "guava/src/com/google/common/primitives/Floats.java", "guava/src/com/google/common/primitives/Ints.java", "guava/src/com/google/common/primitives/Longs.java", "guava/src/com/google/common/primitives/Shorts.java", "guava/src/com/google/common/util/concurrent/CycleDetectingLockFactory.java"], "title": "Concurrency bug in AbstractMultimap"}, "2866": {"body": "Exception cause can be set by initCause method which can lead to a circular reference:\r\n```java\r\nException cause = new Exception();\r\nException exception = new Exception(cause);\r\ncause.initCause(exception);\r\n```\r\nCalling `Throwables.getCausalChain( exception )` or `Throwables.getRootCause( exception )` could lead to an infinitive loop.\r\n\r\nIt is good idea to use a `Set` to add cause exceptions to avoid iterating over a circular reference when `Set.add` method returns `false`. ", "fixed_time": "2017-07-07T19:45:26", "label": [0], "files": ["android/guava-tests/test/com/google/common/base/ThrowablesTest.java", "android/guava/src/com/google/common/base/Throwables.java", "guava-gwt/test/com/google/common/base/ThrowablesTest_gwt.java", "guava-tests/test/com/google/common/base/ThrowablesTest.java", "guava/src/com/google/common/base/Throwables.java"], "title": "Make Throwables.getCausalChain and Throwables.getRootCause cyclic reference safe"}, "2457": {"body": "", "fixed_time": "2016-04-15T18:20:15", "label": [0], "files": ["guava-gwt/test/com/google/common/base/ThrowablesTest_gwt.java", "guava-tests/test/com/google/common/base/ThrowablesTest.java", "guava/src/com/google/common/base/Throwables.java"], "title": "Emulate Throwables in GWT"}, "2430": {"body": "As they are [common headers](https://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Common_non-standard_request_fields) (at least the `X-Forwarded-Host`) it would be nice if they are defined in the class `HttpHeaders`. The `X-Forwared-Port` is used for example in [AWS](http://docs.aws.amazon.com/ElasticLoadBalancing/latest/DeveloperGuide/x-forwarded-headers.html).\n", "fixed_time": "2016-03-22T17:44:16", "label": [5], "files": ["guava/src/com/google/common/net/HttpHeaders.java"], "title": "Add a constant for X-Forwarded-Host and X-Forwarded-Port to HttpHeaders"}, "2843": {"body": "The default implementations of `{Byte,Char}Source.isEmpty()` seem to do unnecessary work when the size is known to be non-zero.\r\n\r\nHere is what `ByteSource` does now:\r\n\r\n```java\r\npublic boolean isEmpty() throws IOException {\r\n  Optional<Long> sizeIfKnown = sizeIfKnown();\r\n  if (sizeIfKnown.isPresent() && sizeIfKnown.get() == 0L) {\r\n    return true;\r\n  }\r\n  // Fall back to reading a byte from the input stream...\r\n```\r\n\r\nI feel like it should do this instead:\r\n\r\n```java\r\npublic boolean isEmpty() throws IOException {\r\n  Optional<Long> sizeIfKnown = sizeIfKnown();\r\n  if (sizeIfKnown.isPresent()) {\r\n    return sizeIfKnown.get() == 0L;\r\n  }\r\n  // Fall back to reading a byte from the input stream...\r\n```\r\n\r\nThat way it avoids reading the input stream when the size is known to be non-zero.\r\n\r\nI see warnings in the javadocs that some sources report inaccurate sizes, but the example given is non-empty files that report a size of zero.  Are there empty files that falsely report a non-zero size?  If not, I think this change is safe.", "fixed_time": "2017-06-13T17:25:50", "label": [0], "files": ["android/guava/src/com/google/common/io/ByteSource.java", "android/guava/src/com/google/common/io/CharSource.java", "guava/src/com/google/common/io/ByteSource.java", "guava/src/com/google/common/io/CharSource.java"], "title": "Optimize {Byte,Char}Source.isEmpty() for known-non-empty sources"}, "1947": {"body": "When decoding Base64/32/16 data an exception is thrown if an invalid character is found:\n\nBaseEncoding.java:501:\n\n``` java\n    int decode(char ch) throws IOException {\n      if (ch > Ascii.MAX || decodabet[ch] == -1) {\n        throw new DecodingException(\"Unrecognized character: \" + ch);\n      }\n      return decodabet[ch];\n    }\n```\n\nThe exception message prints out the character itself, which isn't terribly helpful when that is a non-printable character.  Recommend that the hex value of the character be printed instead.\n", "fixed_time": "2015-01-20T20:44:39", "label": [0], "files": ["guava-gwt/src-super/com/google/common/io/super/com/google/common/io/BaseEncoding.java", "guava-gwt/test-super/com/google/common/io/super/com/google/common/io/BaseEncodingTest.java", "guava-gwt/test/com/google/common/io/BaseEncodingTest_gwt.java", "guava-gwt/test/com/google/common/io/testModule.gwt.xml", "guava-tests/test/com/google/common/io/BaseEncodingTest.java", "guava/src/com/google/common/io/BaseEncoding.java"], "title": "Improve invalid character exceptions from BaseEncoding"}, "2008": {"body": "I ran into a situation where I was using recursion and lazy iteration to emulate the in-order traversal path of a binary tree, but wasn't able to use `Iterators.concat` due to its non gc friendly implementation.\n\n(Note: the amount of memory that should be needed to run this is `O(maxDepth)` or `O(log N)`)\n\nHere's code to trigger the issue, and a potential solution: https://gist.github.com/devinrsmith/121d9a5ebd460c3bbaa0\n", "fixed_time": "2015-04-07T17:54:59", "label": [1], "files": ["guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/Iterables.java", "guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/Iterators.java", "guava/src/com/google/common/collect/ConsumingQueueIterator.java", "guava/src/com/google/common/collect/Iterables.java", "guava/src/com/google/common/collect/Iterators.java"], "title": "Iterators.concat is not gc friendly"}, "2196": {"body": "Let a < x < b:\n- [x].intersection([x]) should return [x], returns [],\n- [x].intersection([a..b]) should return [x], returns [],\n- [a..b].intersection([x]) should return [x], returns [],\n- [a..x].intersection([x..b]) should return [x], returns [].\n\nI'll create a PR in a minute.\n", "fixed_time": "2015-10-23T16:52:48", "label": [1], "files": ["guava-tests/test/com/google/common/collect/ContiguousSetTest.java", "guava/src/com/google/common/collect/RegularContiguousSet.java"], "title": "ContiguousSet.intersection doesn't handle singleton results."}, "1": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1) created by **b.k.oxley** on 2009-09-16 at 04:03 PM_\n\n---\n\nTop issues for me -- when you begin releasing jar files, please provide\nsome kind of maven support for them.  Ideal would be to include the\nbinary/source/javadoc triplet jars in the maven central repo.\n", "fixed_time": "2014-10-31T18:26:27", "label": [1], "files": ["guava-tests/test/com/google/common/graph/AbstractGraphTest.java", "guava-tests/test/com/google/common/graph/GraphsTest.java", "guava/src/com/google/common/graph/AbstractGraph.java", "guava/src/com/google/common/graph/ConfigurableMutableGraph.java", "guava/src/com/google/common/graph/GraphBuilder.java", "guava/src/com/google/common/graph/Graphs.java", "guava/src/com/google/common/graph/ImmutableGraph.java", "guava/src/com/google/common/graph/MutableGraph.java", "guava/src/com/google/common/graph/MutableNetwork.java"], "title": "Maven repo"}, "1819": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1819) created by **ogregoire** on 2014-07-29 at 03:35 PM_\n\n---\n\nWhen I call the following, the test case fails (see full test case in attachment).\n\n&nbsp;&nbsp;new ClassSanityTester().testNulls(MyObject.class);\n\nI get the following error: No exception thrown for parameter at index 0 from MyObjectTest$MyObject.public boolean MyObjectTest$MyObject.equals(java.lang.Object)[null] for class MyObjectTest$MyObject\n\nClearly, this indicates that it expects a call to \"equals(Object)\" to throw a NullPointerException. That method should never throw an exception but rather return true or false. The test seems to skip this assertion and I'm surprised this hasn't been reported earlier. \n\nPlease make it so ClassSanityTester#testNulls(Class) doesn't fail when equals is behaving correctly (see the test case where testEquals(MyObject.class succeeds).\n\nOn a side note, the text returned should be adapted as it mentions three times MyObjectTest$MyObject. That's 2 too many, and it renders the whole error message nearly not understandable.\n", "fixed_time": "2016-08-23T19:00:15", "label": [1], "files": ["guava-testlib/src/com/google/common/testing/NullPointerTester.java", "guava-testlib/test/com/google/common/testing/NullPointerTesterTest.java"], "title": "NullPointerTester should not require @Nullable on the param of an equals() override"}, "2525": {"body": "The [snapshot Javadoc of Ordering#explicit(java.util.List)](http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/collect/Ordering.html#explicit%28java.util.List%29)  contains the sentnece:\n\n> The returned comparator throws **an ClassCastException** when it receives an input parameter that isn't among the provided values.\n\ninstead of\n\n> The returned comparator throws **a ClassCastException** when it receives an input parameter that isn't among the provided values.\n", "fixed_time": "2016-07-12T15:23:05", "label": [2], "files": ["guava/src/com/google/common/collect/Ordering.java"], "title": "Typo in the javadoc of Ordering's explicit(List<T>) method"}, "1738": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1738) created by **socram8888** on 2014-04-24 at 10:38 AM_\n\n---\n\nApparently Oracle has added a new abstract method to TypeVariable (getAnnotatedBounds) which is not implemented.\n", "fixed_time": "2014-12-18T17:54:22", "label": [7], "files": ["guava/src/com/google/common/reflect/Types.java"], "title": "Unable to compile on Java 8"}, "1977": {"body": "ImmutableList contains following code since version 15.0\n\n private static final ImmutableList<Object> EMPTY =\n      new RegularImmutableList<Object>(ObjectArrays.EMPTY_ARRAY);\n", "fixed_time": "2015-06-23T04:42:58", "label": [1], "files": ["guava/src/com/google/common/collect/ImmutableList.java", "guava/src/com/google/common/collect/RegularImmutableList.java"], "title": "Possible deadlock in ImmutableList "}, "2132": {"body": "Missed several video MimeTypes in MediaType class:\n\n```\nvideo/x-flv\nvideo/3gpp\nvideo/3gpp2\n```\n\nand some audio types:\n\n```\naudio/basic\naudio/L24\naudio/aac\naudio/vorbis\naudio/x-ms-wma\naudio/x-ms-wax\naudio/vnd.rn-realaudio\naudio/vnd.wave\n```\n", "fixed_time": "2016-01-21T06:18:08", "label": [5], "files": ["guava/src/com/google/common/net/MediaType.java"], "title": "Add video MediaTypes"}, "2133": {"body": "`MoreExecutors.java:541`\n\n``` java\n    @Override\n    public <V> ListenableScheduledFuture<V> schedule(\n        Callable<V> callable, long delay, TimeUnit unit) {\n      TrustedListenableFutureTask<V> task = TrustedListenableFutureTask.create(callable);\n      ScheduledFuture<?> scheduled = delegate.schedule(task, delay, unit);\n      return new ListenableScheduledTask<V>(task, scheduled);\n    }\n```\n\n`delegate.schedule(Runnable...)` is invoked here instead of the (intended?) `delegate.schedule(Callable<V>...)`. As a result, the `ScheduledListeningDecorator` is unusable for `Callable<?>`.\n", "fixed_time": "2015-10-01T18:27:42", "label": [2], "files": ["guava-tests/test/com/google/common/util/concurrent/MoreExecutorsTest.java"], "title": "BUG: ScheduledListeningDecorator schedule(Callable<V>....) delegates to schedule(Runnable"}, "2228": {"body": "If I want to load a resource I have found by classpath scanning with `ClassPath`, I need to use `Resources.asByteSource(resourceInfo.url())`. This is only little code, but hard to discover because it uses a third class `Resources` which is neither related to what I have (`ResourceInfo`) nor what I want (`ByteSource`). I also need to remember that I should go via the URL and that I cannot use `ResourceInfo.getResourceName()`.\n\nA direct method to get a `ByteSource` from a `ResourceInfo` would make this easier. Alternatively, this should be documented at least.\n", "fixed_time": "2016-01-27T16:40:49", "label": [5], "files": ["guava-tests/test/com/google/common/reflect/ClassPathTest.java", "guava/src/com/google/common/reflect/ClassPath.java"], "title": "Add ClassPath.ResourceInfo.asByteSource()"}, "2522": {"body": "The snapshot API has the following typos:\n\n`com.google.common.math.StatsAccumulator`: `public final double populationVariance()` and\n`com.google.common.math.Stats`: `public double populationVariance()` say\n\n> This is guaranteed to return zero if **the the** dataset contains only exactly one finite value.\n\nInstead of\n\n> This is guaranteed to return zero if **the** dataset contains only exactly one finite value.\n", "fixed_time": "2016-07-09T21:25:43", "label": [2], "files": ["guava/src/com/google/common/math/Stats.java", "guava/src/com/google/common/math/StatsAccumulator.java"], "title": "Typo in the javadoc of StatsAccumulator's and Stats's populationVariance() method"}, "1942": {"body": "Please see https://github.com/google/guava/blob/master/guava/src/com/google/common/primitives/Booleans.java#L235.\n\nIsn't Java 6 available?\nIf it is, should that comment be removed?\nShould the method be removed? (It is private and only used in a single place).\n", "fixed_time": "2016-01-14T13:00:24", "label": [6], "files": ["guava/src/com/google/common/primitives/Booleans.java", "guava/src/com/google/common/primitives/Bytes.java", "guava/src/com/google/common/primitives/Chars.java", "guava/src/com/google/common/primitives/Doubles.java", "guava/src/com/google/common/primitives/Floats.java", "guava/src/com/google/common/primitives/Ints.java", "guava/src/com/google/common/primitives/Longs.java", "guava/src/com/google/common/primitives/Shorts.java"], "title": "Line comment on requiring Java 6"}, "2349": {"body": "The [javadoc for TestContainerGenerator.order](https://github.com/google/guava/blob/master/guava-testlib/src/com/google/common/collect/testing/TestContainerGenerator.java#L66) states:\n\n> This method runs only when CollectionFeature#KNOWN_ORDER is specified when creating the test suite. It should never run when testing containers such as HashSet, which have a non-deterministic iteration order.\n\nHowever, 74 tests (out of 450) fail with the code below which (as described by the documentation) expects TestContainerGenerator.order not to be called and throws an UnsupportedOperationException for it:\n\n``` java\npublic final class JavaUtilCollectionsTests {\n  public static Test suite() {\n    TestSuite suite = new TestSuite(\"HashSet\");\n    suite.addTest(SetTestSuiteBuilder.<Integer>using(new TestSetGenerator<Integer>() {\n      @Override\n      public SampleElements<Integer> samples() {\n        return new SampleElements<Integer>(-7, 0, Integer.MIN_VALUE, 42, Integer.MAX_VALUE);\n      }\n\n      @Override\n      public Integer[] createArray(int length) {\n        return new Integer[length];\n      }\n\n      @Override\n      public Iterable<Integer> order(List<Integer> insertionOrder) {\n        throw new UnsupportedOperationException();\n      }\n\n      @Override\n      public Set<Integer> create(Object... elements) {\n        List<Integer> values =\n            Arrays.stream(elements).map(o -> (Integer) o).collect(Collectors.toList());\n        return new HashSet<>(values);\n      }\n    }).named(\"HashSet\")\n        .withFeatures(CollectionSize.ANY, CollectionFeature.GENERAL_PURPOSE,\n            CollectionFeature.ALLOWS_NULL_VALUES, CollectionFeature.SERIALIZABLE_INCLUDING_VIEWS)\n        .createTestSuite());\n    return suite;\n  }\n}\n```\n\nThe expected result would be for all the tests to pass.\n", "fixed_time": "2016-03-18T19:01:01", "label": [1], "files": ["guava-testlib/src/com/google/common/collect/testing/TestContainerGenerator.java"], "title": "Test suites incorrectly call TestSetGenerator.order"}, "1961": {"body": "On the theory that most things should be a `TrustedFuture` :)\n\nWe would probably skip `immediateFuture` because there's little to optimize there: We'd basically be replacing one field access with another.\n\nBut why not do `immediateFuture` anyway? `TrustedFuture` is a bit larger than `immediateFuture`, since it stores listeners and waiters (\"would increase the size of the immediateFuture implementations by a least 8 bytes a piece (+ padding),\" per Luke).\n\nWe care about that less with failed and cancelled futures, since they have large `Exception` objects associated with them already.\n\nAlternatively, we could special-case `ImmediateFuture` in the same way that we special-case `TrustedFuture` -- either with a separate `instanceof` branch or with an interface. Then we could do all the whole `immediate*Future` family with no cost... unless the branch/interface has a performance cost.\n", "fixed_time": "2016-03-14T13:52:57", "label": [0], "files": ["guava-gwt/src-super/com/google/common/util/concurrent/super/com/google/common/util/concurrent/Futures.java", "guava/src/com/google/common/util/concurrent/AbstractFuture.java", "guava/src/com/google/common/util/concurrent/Futures.java"], "title": "Make immediateFailedFuture and immediateCancelledFuture return a TrustedFuture?"}, "1963": {"body": "Would be keen to use these in non-`@Beta`. Are there any plans?\n", "fixed_time": "2015-03-12T21:46:56", "label": [0], "files": ["guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/FluentIterable.java", "guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/Maps.java", "guava/src/com/google/common/collect/FluentIterable.java", "guava/src/com/google/common/collect/Maps.java"], "title": "De-@Beta Maps.asMap and toMap"}, "2037": {"body": "Uncorrect hashCode() implementation at com.google.common.base.Absent and com.google.common.base.Present - for example if hashCode() of reference at Present return 0 then it hashCode() equal Absent.\n\nexample: Optional.absent() has same hash code as Optional.of(0.0) or Optional.of(0)\n", "fixed_time": "2015-04-24T19:51:08", "label": [0], "files": ["guava-gwt/test-super/com/google/common/base/super/com/google/common/base/OptionalTest.java", "guava-tests/test/com/google/common/base/OptionalTest.java", "guava/src/com/google/common/base/Absent.java"], "title": "Optional.hashCode()"}, "1444": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1444) created by **cpovirk@google.com** on 2013-06-11 at 09:49 PM_\n\n---\n\nJust as we've inverted Class.isInstance to Predicates.instanceOf, we ought to have inverted Class.isAssignableFrom to Predicates.assignableTo.\n\nAnd the doc says: \"true if the class being tested is assignable from the given class\"\ufeff\nhttps://google.github.io/guava/apidocs/com/google/common/base/Predicates.html#assignableFrom(java.lang.Class)\n\nBut it's the other way around.\n", "fixed_time": "2016-04-26T20:08:19", "label": [1], "files": ["guava-tests/test/com/google/common/base/PredicatesTest.java", "guava/src/com/google/common/base/Predicates.java"], "title": "Predicates.assignableFrom is named backward, and its doc is backward, too"}, "2072": {"body": "(Source attached below which demonstrates the issue).\nI have an implementation of an AbstractScheduledService which overrides the scheduler() method and creates and returns a CustomScheduler.  This CustomScheduler's getNextSchedule() method sleeps for a period of time (which makes the deadlock more predicable) and then either returns a Schedule, or if the Service\u2019s state is STOPPING it throws an exception.  \nThe problem arises when it throws an exception.  After throwing the exception the service never actually terminates, and the shutDown() method is never called.  After a brief investigation, it looks as though there is a deadlock between notifyFailed() and stopAsync() in AbstractService class.  notifyFailed() (called from the catch block of reschedule() method in one of AbstractScheduledService inner classes) tries to enter the monitor field but is blocked as the monitor is currently held by stopAsync(), and stopAsync() hasn\u2019t released the monitor yet as it is blocked when calling this.doStop() (in case 3 of switch stmt).  The doStop() called is the impl in AbstractScheduledService, and this gets blocked on the first line waiting for this.runningTask.cancel(false) to return.\n\nI haven\u2019t had time to download the source code and build things myself to investigate it further, but hopefully there is enough here to go on.  Below is some source code which demonstrates the problem, and the log output showing that the service\u2019s shutDown() method is not called and the service and JVM hasn\u2019t terminated yet.\n\n``` java\npublic class Main {\n    public static void main(String[] args) throws Exception {\n        Service service = new ScheduledServiceWithCustomBlockingScheduler(5000);\n        new ServiceStateMonitor().monitorServiceStateWithServiceListener(service);\n        System.out.println(\"starting service\");\n        service.startAsync();\n        Thread.sleep(6000); // wait just enough time for 2nd call of getNextSchedule() to start\n        System.out.println(\"Stopping service\");\n        service.stopAsync();\n        System.out.println(\"Bye\");\n      }\n}\n```\n\n``` java\npublic class ScheduledServiceWithCustomBlockingScheduler extends AbstractScheduledService {\n    private long blockTime;\n\n    public ScheduledServiceWithCustomBlockingScheduler(final long blockTime) {\n        this.blockTime = blockTime;\n    }\n\n    @Override\n    protected void runOneIteration() throws Exception {\n        System.out.println(\"runOneIteration()\");\n    }\n\n    @Override\n    protected Scheduler scheduler() {\n        return new CustomScheduler() {\n            @Override\n            protected Schedule getNextSchedule() throws Exception {\n                System.out.println(\"getNextSchedule()...\");\n                Thread.sleep(blockTime);\n                if (state() == State.STOPPING) {\n                    System.out.println(\"getNextSchedule() - not running anymore so don't return scheduler\");\n                    throw new Exception(\"not running anymore so don't return scheduler\");\n                }\n                System.out.println(\"...getNextSchedule()\");\n                return new Schedule(0, TimeUnit.NANOSECONDS);\n            }\n        };\n    }\n\n    @Override\n    protected void startUp() throws Exception {\n        System.out.println(\"startUp()\");\n    }\n\n    @Override\n    protected void shutDown() throws Exception {\n        System.out.println(\"shutDown()\");\n    }\n}\n```\n\n``` java\npublic class ServiceStateMonitor {\n    public void monitorServiceStateWithServiceListener(final Service serviceToMonitor) {\n        serviceToMonitor.addListener(new PrintOutNewStateServiceListener(), MoreExecutors.directExecutor());\n    }\n\n    private class PrintOutNewStateServiceListener extends Service.Listener {\n        @Override\n        public void starting() {\n            System.out.println(\"SERVICE LISTENER : Starting\");\n        }\n\n        @Override\n        public void running() {\n            System.out.println(\"SERVICE LISTENER : Running\");\n        }\n\n        @Override\n        public void stopping(final Service.State from) {\n            System.out.println(\"SERVICE LISTENER : Stopping\");\n        }\n\n        @Override\n        public void terminated(final Service.State from) {\n            System.out.println(\"SERVICE LISTENER : Terminated\");\n        }\n\n        @Override\n        public void failed(final Service.State from, final Throwable failure) {\n            System.out.println(\"SERVICE LISTENER : Failed\");\n        }\n    }\n}\n```\n\nThe Standard Ouput from running the main()\n\n```\nstarting service\nSERVICE LISTENER : Starting\nstartUp()\ngetNextSchedule()...\n...getNextSchedule()\nSERVICE LISTENER : Running\nrunOneIteration()\ngetNextSchedule()...\nStopping service\ngetNextSchedule() - not running anymore so don't return scheduler\n```\n\nnotice that there is no \"shutDown()\" or \"Bye\" output line.\n", "fixed_time": "2015-06-16T19:44:59", "label": [1], "files": ["guava-tests/test/com/google/common/util/concurrent/AbstractScheduledServiceTest.java", "guava/src/com/google/common/util/concurrent/AbstractScheduledService.java"], "title": "Deadlock when stopping an AbstractScheduledService and Exception thrown from CustomScheduler.getNextSchedule()"}, "2365": {"body": "Not a high priority. I just feel a little bad that users there would get something like \"com.google.common.base.Stopwatch@0xdeadbeef\".\n", "fixed_time": "2016-04-01T17:02:58", "label": [1], "files": ["guava-gwt/src-super/com/google/common/base/super/com/google/common/base/Platform.java", "guava-gwt/test/com/google/common/base/StopwatchTest_gwt.java", "guava-tests/test/com/google/common/base/StopwatchTest.java", "guava/src/com/google/common/base/Platform.java", "guava/src/com/google/common/base/Stopwatch.java"], "title": "Implement Stopwatch.toString() under GWT"}, "2158": {"body": "The visitClass implementation in TypeResolver.populateTypeMappings has the following body:\n\n```\n  @Override void visitClass(Class<?> fromClass) {\n    // Can't map from a raw class to anything other than itself.\n    // You can't say \"assuming String is Integer\".\n    // And we don't support \"assuming String is T\"; user has to say \"assuming T is String\". \n    throw new IllegalArgumentException(\"No type mapping from \" + fromClass);\n  }\n```\n\nIt would be great if the IllegalArgumentException message reported the type it's trying to convert to, as well as the one its converting from, for easier debugging should this exception be thrown.\n", "fixed_time": "2015-10-01T18:40:35", "label": [0], "files": ["guava/src/com/google/common/reflect/TypeResolver.java"], "title": "TypeVisitor.visitClass in TypeResolver.populateTypeMappings should report the to type as well as the from type"}, "1451": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1451) created by **drothmaler** on 2013-06-18 at 01:46 PM_\n\n---\n\nI think it would be good to extend the NaturalOrdering and ReverseNaturalOrdering implementations, to hold instances of their nullsFirst() and nullsLast() versions too.\nThis is because things like Ordering.natural().nullsFirst() are frequently used and currently there will be created a NullsFirstOrdering/NullsLastOrdering instance each time, you access it. \n\nIn many cases this will not be a problem, but if you use it inside a compareTo or compare method (e.g. in combination with the ComparisonChain as suggested in Issue 500 & Issue 556), it really makes a difference whether you use a share instance, or not.\n", "fixed_time": "2015-10-13T18:32:51", "label": [3], "files": ["guava/src/com/google/common/collect/NaturalOrdering.java"], "title": "Use Singleton instances for nullable natural Orderings"}, "2039": {"body": "Hello, I was reading through the set of tests at https://github.com/google/guava/blob/master/guava-tests/test/com/google/common/base/StopwatchTest.java , and I noticed there are two tests that appear to do the same thing - testElapsed_millis() and testElapsedMillis(). Is this expected? Could one test perhaps be an old test under a different naming convention? From the history it looks like they were added independently.\n\nThe contribution guide recommends creating an issue as the first step, so I thought I would ask.\n\nGitHub suggests that both functions are only called from guava-gwt/test/com/google/common/base/StopwatchTest_gwt.java . Would it be appropriate to create a pull request to remove one of the tests? (Or of course, feel free to simply remove one yourself if the workflow is easier; I just wanted to ask)\n\nCheers!\n", "fixed_time": "2015-04-23T16:01:20", "label": [6], "files": ["guava-gwt/test-super/com/google/common/base/super/com/google/common/base/StopwatchTest.java", "guava-gwt/test/com/google/common/base/StopwatchTest_gwt.java", "guava-tests/test/com/google/common/base/StopwatchTest.java"], "title": "Possible duplicate tests? - testElapsed_millis() and testElapsedMillis()"}, "1567": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1567) created by **sebastian.davids** on 2013-11-04 at 06:57 AM_\n\n---\n\nFailed tests: \n&nbsp;&nbsp;testToString(com.google.common.base.StopwatchTest): null expected:&lt;0[.]000 ns> but was:&lt;0[,]000 ns>\n&nbsp;&nbsp;testSimple(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, R0.20, R0.]20]> but was:<[R0[,00, R0,20, R0,]20]>\n&nbsp;&nbsp;testSimpleWithWait(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, U0.20, R0.00, R0.]20]> but was:<[R0[,00, U0,20, R0,00, R0,]20]>\n&nbsp;&nbsp;testOneSecondBurst(com.google.common.util.concurrent.RateLimiterTest): null expected:<[U1[.00, U1.00, R0.00, R0.00, R0.00, R0.00, R0.]20]> but was:<[U1[,00, U1,00, R0,00, R0,00, R0,00, R0,00, R0,]20]>\n&nbsp;&nbsp;testWarmUp(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, R1.38, R1.13, R0.88, R0.63, R0.50, R0.50, R0.50, U0.50, U4.00, R0.00, R1.38, R1.13, R0.88, R0.63, R0.50, R0.50, R0.50, U0.50, U2.00, R0.00, R0.50, R0.50, R0.50, R0.50, R0.50, R0.50, R0.]50]> but was:<[R0[,00, R1,38, R1,13, R0,88, R0,63, R0,50, R0,50, R0,50, U0,50, U4,00, R0,00, R1,38, R1,13, R0,88, R0,63, R0,50, R0,50, R0,50, U0,50, U2,00, R0,00, R0,50, R0,50, R0,50, R0,50, R0,50, R0,50, R0,]50]>\n&nbsp;&nbsp;testWarmUpAndUpdate(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, R1.38, R1.13, R0.88, R0.63, R0.50, R0.50, R0.50, U4.50, R0.00, R1.38, R1.13, R0.88, R0.34, R0.28, R0.25, R0.25, U4.25, R0.00, R0.72, R0.66, R0.59, R0.53, R0.47, R0.41, R0.34, R0.28, R0.25, R0.]25]> but was:<[R0[,00, R1,38, R1,13, R0,88, R0,63, R0,50, R0,50, R0,50, U4,50, R0,00, R1,38, R1,13, R0,88, R0,34, R0,28, R0,25, R0,25, U4,25, R0,00, R0,72, R0,66, R0,59, R0,53, R0,47, R0,41, R0,34, R0,28, R0,25, R0,]25]>\n&nbsp;&nbsp;testBursty(com.google.common.util.concurrent.RateLimiterTest): null expected:<[U10[.00, R0.00, R1.00, R1.00, U3.00, R0.00, R3.]00]> but was:<[U10[,00, R0,00, R1,00, R1,00, U3,00, R0,00, R3,]00]>\n&nbsp;&nbsp;testBurstyAndUpdate(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, R1.00, R1.00, R0.50, R1.00, R2.]00]> but was:<[R0[,00, R1,00, R1,00, R0,50, R1,00, R2,]00]>\n&nbsp;&nbsp;testTimeWrapping(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, R1.00, R1.00, R1.]00]> but was:<[R0[,00, R1,00, R1,00, R1,]00]>\n&nbsp;&nbsp;testSimpleWeights(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, R1.00, R1.00, R2.00, R4.00, R8.]00]> but was:<[R0[,00, R1,00, R1,00, R2,00, R4,00, R8,]00]>\n&nbsp;&nbsp;testInfinity_Bursty(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, R0.00, R0.]00]> but was:<[R0[,00, R0,00, R0,]00]>\n&nbsp;&nbsp;testInfinity_WarmUp(com.google.common.util.concurrent.RateLimiterTest): null expected:<[R0[.00, R0.00, R0.]00]> but was:<[R0[,00, R0,00, R0,]00]>\n\n@@\n\nInstead of:\n\nString.format(\"%.4g %s\", value, abbreviate(unit));\n\nyou might want to use:\n\nString.format(Locale.ROOT, \"%.4g %s\", value, abbreviate(unit));\n\n@@\n\nYou might want to check the entire codebase for usages of String.format without an explicit Locale.\n", "fixed_time": "2015-01-14T19:02:55", "label": [1], "files": ["guava-testlib/src/com/google/common/collect/testing/Platform.java", "guava-testlib/src/com/google/common/collect/testing/features/FeatureUtil.java", "guava-testlib/src/com/google/common/collect/testing/testers/Platform.java", "guava-testlib/src/com/google/common/testing/AbstractPackageSanityTests.java", "guava-testlib/src/com/google/common/testing/GcFinalization.java", "guava-testlib/test/com/google/common/collect/testing/features/FeatureEnumTest.java", "guava-testlib/test/com/google/common/testing/NullPointerTesterTest.java", "guava-tests/pom.xml", "guava-tests/test/com/google/common/collect/FauxveridesTest.java", "guava-tests/test/com/google/common/hash/HashingTest.java", "guava-tests/test/com/google/common/primitives/CharsTest.java", "guava-tests/test/com/google/common/util/concurrent/GeneratedMonitorTest.java", "guava-tests/test/com/google/common/util/concurrent/RateLimiterTest.java", "guava-tests/test/com/google/common/util/concurrent/ServiceTest.java", "guava-tests/test/com/google/common/util/concurrent/ThreadFactoryBuilderTest.java", "guava/src/com/google/common/base/Stopwatch.java", "guava/src/com/google/common/cache/CacheBuilderSpec.java", "guava/src/com/google/common/eventbus/EventBus.java", "guava/src/com/google/common/net/InetAddresses.java", "guava/src/com/google/common/util/concurrent/RateLimiter.java", "guava/src/com/google/common/util/concurrent/ThreadFactoryBuilder.java", "guava/src/com/google/common/util/concurrent/UncaughtExceptionHandlers.java"], "title": "Running tests in a non-US locale might fail"}, "1999": {"body": "- @lowasser internal CL 88242480 wants to use `SimpleImmutableEntry`.\n- Internal CL 86210805 can be rolled back to use `AssertionError(String, Throwable)`.\n- @kak internal CL 83767705 wanted to use `Arrays.copyOf`.\n- My internal CL 59647656 wants to remove `AbstractIteratorTester` workarounds for bugs in `java.util` classes fixed in new releases of GWT.\n\nGWT 2.7.0 was released in November. But note that we had bug reports from users of GWT 2.5.1 as late as October 2014, 9 months after the release of 2.6.0. We should get some idea of how quickly external users update the version of GWT they use.\n", "fixed_time": "2016-10-06T21:13:23", "label": [7], "files": ["guava-tests/test/com/google/common/util/concurrent/FuturesTest.java"], "title": "Release a Guava that supports+requires GWT 2.8.0 upon GWT release"}, "1312": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1312) created by **vgal...@tennaxia.com** on 2013-02-28 at 01:05 PM_\n\n---\n\nHello,\n\nIt would be great if Stopwatch could be promoted in next release.\n\nThank you\n\nvictor\n", "fixed_time": "2015-06-02T19:22:12", "label": [7], "files": ["guava-gwt/src-super/com/google/common/base/super/com/google/common/base/Stopwatch.java", "guava/src/com/google/common/base/Stopwatch.java"], "title": "De-@Beta Stopwatch"}, "releases": {"20.0": "2016-10-28T21:30:59", "23.0-rc1": "2017-08-07T19:35:55", "22.0-rc1": "2017-05-23T18:37:46", "21.0": "2017-01-12T21:41:28", "20.0-rc1": "2016-10-07T17:44:49", "24.0": "2018-02-01T20:52:13", "22.0": "2017-05-23T18:38:13", "23.6": "2017-12-21T17:26:26", "23.5": "2017-11-22T21:05:04", "23.4": "2017-11-09T18:29:33", "23.3": "2017-10-26T20:40:49", "23.2": "2017-10-11T23:30:53", "23.1": "2017-09-27T21:09:10", "23.0": "2017-08-07T19:35:20", "21.0-rc1": "2016-12-21T20:43:25", "21.0-rc2": "2017-01-03T22:25:22"}, "2463": {"body": "We already do in `AbstractFuture`.\n", "fixed_time": "2016-04-20T15:58:01", "label": [1], "files": ["guava-tests/test/com/google/common/util/concurrent/AggregateFutureStateFallbackAtomicHelperTest.java", "guava-tests/test/com/google/common/util/concurrent/FuturesTest.java", "guava/src/com/google/common/util/concurrent/AggregateFutureState.java", "guava/src/com/google/common/util/concurrent/InterruptibleTask.java"], "title": "Work around Samsung 5.0.x Atomic*FieldUpdater bug in AggregateFutureState and InterruptibleTask"}, "1125": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1125) created by **adrianshum** on 2012-08-29 at 03:06 AM_\n\n---\n\nCurrently there is no handling for arrays in helpers in Objects, e.g. toStringHelper and Object.equal.\n\nThat means, I cannot do\nObjects.toStringHelper(getClass())\n&nbsp;&nbsp;&nbsp;&nbsp;.add(\"foo\", this.foo)\n&nbsp;&nbsp;&nbsp;&nbsp;.add(\"anArray\", this.anArray)\n&nbsp;&nbsp;&nbsp;&nbsp;.toString();\n\n(I know I can change it to add(\"anArray\", Arrays.toString(this.anArray)) but it looks bad)\n\nSame for Objects.equal, when I am overriding equals(), I cannot do:\nreturn Objects.equal(\"foo\", other.foo) \n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&& Objects.equals(\"anArray\", other.anArray);\n\nI believe adding corresponding overloads should not be difficult, and it makes the API much easier to use.\n", "fixed_time": "2015-05-20T20:26:02", "label": [0], "files": ["guava/src/com/google/common/base/MoreObjects.java"], "title": "Array handling in Objects#toStringHelper"}, "1596": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1596) created by **jens.von...@numberfour.eu** on 2013-11-29 at 03:56 PM_\n\n---\n\nThe List interface does not state that it must allow duplicate elements, it is only stated as the typical case:\n\n\"Unlike sets, lists typically allow duplicate elements. More formally, lists typically allow pairs of elements e1 and e2 such that e1.equals(e2), and they typically allow multiple null elements if they allow null elements at all. It is not inconceivable that someone might wish to implement a list that prohibits duplicates, by throwing runtime exceptions when the user attempts to insert them, but we expect this usage to be rare.\" (java.util.List, JavaDoc).\n\nWhen a list prohibits duplicates, \ncom.google.common.collect.Iterables.removeIfFromRandomAccessList(List&lt;T>, Predicate<? super T>) \nleads to exceptions, because an element temporarily may be contained muiltple times in the list. \nThis is true in particular for EMF's org.eclipse.emf.common.util.AbstractEList&lt;E>, which does not allow duplicates.\n\nSince allowing of duplicates is not a hard constraint of the List interface, I would consider this a bug. In particular since this specialized method is called from com.google.common.collect.Iterables.removeIf(Iterable&lt;T>, Predicate<? super T>), so the client has little control over what's going to happen.\n", "fixed_time": "2015-10-22T18:04:21", "label": [1], "files": ["guava-gwt/test/com/google/common/collect/IterablesTest_gwt.java", "guava-tests/test/com/google/common/collect/IterablesTest.java", "guava/src/com/google/common/collect/Iterables.java"], "title": "Iterables.removeIfFromRandomAccessList(..) not working with Lists prohibiting duplicates"}, "1885": {"body": "MapMaker javadoc advertises \"on-demand computation of values for keys not already present\" but this doesn't appear to actually be possible.\n", "fixed_time": "2014-11-10T21:09:27", "label": [2], "files": ["guava/src/com/google/common/collect/MapMaker.java"], "title": "Javadoc error in MapMaker"}, "149": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=149) created by **joe.kearney%morganst...@gtempaccount.com** on 2009-04-14 at 03:22 PM_\n\n---\n\nThe test framework is thorough beyond belief for those interfaces that it\ncovers. Are there any plans for widening coverage to some of the more\nspecific collection framework interfaces? ConcurrentMap is the first that\nsprings to mind, NavigableMap, Deque, SortedSet and the like might be\nuseful too. Obviously, providing testing for the _concurrency_ part of this\nis a whole different ballgame, but it would be a great start to be able to\ntest at least the single-threaded behaviour.\n\nMore generally (perhaps this belongs in a separate issue), are there any\nplans to make it easier to hook into the framework to test other types? As\na concrete example, I was playing with adding supplyIfAbsent(K,\nCallable/Future&lt;V>) to ConcurrentMap. To cleanly use the test framework\n(after sorting out tests for the other four ConcurrentMap methods) it would\nhelp to have some changes in, for example,\n&nbsp;&nbsp;&nbsp;\\* AbstractMapTester#getMap() to avoid the downcasts to my Map subtype\n&nbsp;&nbsp;&nbsp;\\* TestStringMapGenerator#create(Entry[]) for the same reason\n&nbsp;&nbsp;&nbsp;\\* MapTestSuiteBuilder#getTesters to make it easier to add testers to the\nlist, since Arrays#asList is inconveniently immutable.\n", "fixed_time": "2015-05-29T20:54:31", "label": [5], "files": ["guava-testlib/src/com/google/common/collect/testing/ConcurrentMapTestSuiteBuilder.java", "guava-testlib/src/com/google/common/collect/testing/TestConcurrentMapGenerator.java", "guava-testlib/src/com/google/common/collect/testing/TestStringConcurrentMapGenerator.java", "guava-testlib/src/com/google/common/collect/testing/TestsForMapsInJavaUtil.java", "guava-testlib/src/com/google/common/collect/testing/testers/ConcurrentMapPutIfAbsentTester.java", "guava-testlib/src/com/google/common/collect/testing/testers/MapEntrySetTester.java"], "title": "add testfw support for ConcurrentMap interface methods"}, "2178": {"body": "As a novice of using Cache I think its statistic activation should be documented in the API of stats().\n\nFirst: recordStats() is to be isssued.\nSecond: stats() can not be instantiated because it is a factory for a final statistic.\n", "fixed_time": "2015-11-19T19:39:56", "label": [2], "files": ["guava/src/com/google/common/cache/Cache.java"], "title": "Cache.stats usage should be documented better"}, "1543": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1543) created by **bedla.czech** on 2013-09-25 at 11:58 AM_\n\n---\n\nHi,\n\nI have found strange behaviour of Iterables.removeIf method. When I remove items from iterable by frequency and having them nearby, every found duplicate item is removed even the last one. At a bottom you can find test snippets. There is difference between use of ArrayList and LinkedList.\n\nNote: I know that I should use Set for this kind of situations, but imagine that you do not have String list but list full of legacy uneditable s*it classes. Problem is inside Iterables.removeIfFromRandomAccessList method.\n\n<code language=\"java\">\n&nbsp;&nbsp;&nbsp;&nbsp;@\ufeffTest\n&nbsp;&nbsp;&nbsp;&nbsp;public void testOk() throws Exception {\n\n```\n    final List<String> list = Lists.newArrayList(\"a\", \"b\", \"a\");\n\n    System.out.println(list); // [a, b, a]\n    Iterables.removeIf(list, new Predicate<String>() {\n        @Override\n        public boolean apply(String input) {\n            return Iterables.frequency(list, input) >= 2;\n        }\n    });\n    System.out.println(list); // [b, a]\n\n}\n\n@Test\npublic void testWrong() throws Exception {\n\n    final List<String> list = Lists.newArrayList(\"a\", \"a\", \"a\");\n\n    System.out.println(list); // [a, a, a]\n    Iterables.removeIf(list, new Predicate<String>() {\n        @Override\n        public boolean apply(String input) {\n            return Iterables.frequency(list, input) >= 2;\n        }\n    });\n    System.out.println(list); // [] should be [a]\n\n}\n\n@Test\npublic void testOkWithLinkedList() throws Exception {\n\n    final List<String> list = Lists.newLinkedList();\n    list.add(\"a\");\n    list.add(\"a\");\n    list.add(\"a\");\n\n    System.out.println(list); // [a, a, a]\n    Iterables.removeIf(list, new Predicate<String>() {\n        @Override\n        public boolean apply(String input) {\n            return Iterables.frequency(list, input) >= 2;\n        }\n    });\n    System.out.println(list); // [a]\n\n}\n```\n\n</code>\n", "fixed_time": "2015-10-09T19:09:28", "label": [2], "files": ["guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/Iterables.java", "guava/src/com/google/common/collect/Iterables.java"], "title": "Iterables.removeIf wrong items removed when ArrayList is used"}, "1437": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1437) created by **mike.rumpf** on 2013-05-31 at 06:11 AM_\n\n---\n\nMutableClassToInstanceMap defines a serialVersionUID but itself does not implement Serializable. This is inconsistent to other guava collection types.\n", "fixed_time": "2015-10-23T15:53:10", "label": [0], "files": ["guava-tests/test/com/google/common/collect/MutableClassToInstanceMapTest.java", "guava/src/com/google/common/collect/MutableClassToInstanceMap.java"], "title": "MutableClassToInstanceMap should implement Serializable"}, "1342": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1342) created by **kevinb@google.com** on 2013-03-15 at 05:18 PM_\n\n---\n\nIt's very hard to figure out what Ordering.natural().nullsFirst().reverse().lexicographical().reverse().nullsLast() means.\n\nWe can make it a lot easier for the user by walking through how we read and interpret a few salient examples.\n", "fixed_time": "2015-10-15T23:45:58", "label": [2], "files": ["guava-gwt/test-super/com/google/common/collect/super/com/google/common/collect/OrderingTest.java", "guava-gwt/test/com/google/common/collect/OrderingTest_gwt.java", "guava-tests/test/com/google/common/collect/OrderingTest.java"], "title": "Add docs to Ordering to give guidance how to parse and understand long chains of calls"}, "1328": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1328) created by **gokhanoner** on 2013-03-11 at 03:23 PM_\n\n---\n\nHi,\n\nprivate static final ImmutableSet&lt;String> ISLEM_EB_FIELDS = ImmutableSet.of(\"ISLBLG\");\n\nFor above desc, a singletonImmutableSet is created. When I try\n\nISLEM_EB_FIELDS.toArray(new String[0])\n\non V13.0.1, ist OK but in v14, it throw class not found exception for\n\ncom.google.common.collect.GwtPlatform.java\n\nI tried it on a GWT application.\n", "fixed_time": "2014-11-01T01:15:53", "label": [1], "files": ["guava-gwt/pom.xml", "guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/GwtPlatform.java", "guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/Platform.java", "guava-gwt/src/com/google/common/collect/GwtPlatform.java", "guava-gwt/test-super/com/google/common/collect/testing/super/com/google/common/collect/testing/GwtPlatform.java", "guava-gwt/test-super/com/google/common/collect/testing/super/com/google/common/collect/testing/Platform.java", "guava-gwt/test/com/google/common/collect/testing/GwtPlatform.java"], "title": "ImmutableSet.toArray issue on singletonImmutableSet for v14"}, "2124": {"body": "The next GWT release will probably have emulations for `Charset` built in. Internal CL 99622756 will be removing our custom emulations, but I think we can go further, changing calls to methods like `getBytes` to use the `Charset` versions.\n\nThis assumes that we require the new GWT version for the post-19 Guava release. This was not the plan on #1999 but might be reasonable. Otherwise, we need a workaround. We'd need to figure out if our emulations would interfere with the GWT versions for users who _are_ using the new GWT.\n", "fixed_time": "2016-01-07T22:50:31", "label": [0], "files": ["guava-tests/test/com/google/common/io/BaseEncodingTest.java"], "title": "Use String.getBytes(Charset) and other Charset utilities once GWT supports them"}, "2127": {"body": "An algorithm similar to `java.lang.Math.addExact()` should be used to compute `offset + length`  and fallback to `Integer.MAX_VALUE` or `Long.MAX_VALUE` in case of overflow. \nThere is 3 occurrences of this possibly overflowing addition in `ByteSource.java`.\n\nI found this bug because I regularly slice bytesources with a length equals to Long.MAX_VALUE.\n", "fixed_time": "2015-08-12T18:03:26", "label": [1], "files": ["guava-tests/test/com/google/common/io/ByteSourceTester.java", "guava/src/com/google/common/io/ByteSource.java"], "title": "19rc1 regression in sliced bytesource: offset + length may overflow for large length values"}, "2082": {"body": "I'm a [Spoon](https://github.com/INRIA/spoon) contributor, an open source project to analyse and transform Java source code. This project have a dependency to [JDT](https://eclipse.org/jdt/) to compile target source code. Recently, I tried to analyse Guava with Spoon but JDT can't compile our project.\n\nWhat is the problem?\n\nIn [`ImmutableMap`](https://github.com/google/guava/blob/master/guava/src/com/google/common/collect/ImmutableMap.java) class, we have these methods:\n\n``` java\n// If the map is an EnumMap, it must have key type K for some <K extends Enum<K>>.\n@SuppressWarnings({\"unchecked\", \"rawtypes\"})\nprivate static <K, V> ImmutableMap<K, V> copyOfEnumMapUnsafe(Map<? extends K, ? extends V> map) {\n    return copyOfEnumMap((EnumMap) map);\n}\n\nprivate static <K extends Enum<K>, V> ImmutableMap<K, V> copyOfEnumMap(EnumMap<K, ? extends V> original) {\n    EnumMap<K, V> copy = new EnumMap<K, V>(original);\n    for (Map.Entry<?, ?> entry : copy.entrySet()) {\n        checkEntryNotNull(entry.getKey(), entry.getValue());\n    }\n    return ImmutableEnumMap.asImmutable(copy);\n}\n```\n\nThis code is valid but there is an error from JDT:\n\n> Type mismatch: cannot convert from `<Enum<Enum<K>>>` to `<K>`\n\nBefore the creation of this issue, I reported the bug in the bugtracker of JDT (issue [here](https://bugs.eclipse.org/bugs/show_bug.cgi?id=469404)). In 2 words, the conclusion was that: \"Yes, JDT don't support this usage of Java but there is a better practice\". This better practice is explained [here](https://bugs.eclipse.org/bugs/show_bug.cgi?id=469404#c3):\n\n``` java\nprivate static <K extends Enum<K>> ImmutableMap<K, V> copyOfEnumMap(EnumMap<K, ? extends V> original) {\n    return copyOfEnumMap((EnumMap<K,?>) map);\n}\n```\n\nI tried some tricky solutions but, unfortunately, this solution can't be applied in your project. So I come to notify you that your project can't be compiled by JDT.\n", "fixed_time": "2015-06-22T16:49:13", "label": [], "files": ["guava/src/com/google/common/collect/ImmutableMap.java"], "title": "Guava can't be compiled by JDT"}, "1558": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1558) created by **Maaartinus** on 2013-10-19 at 04:37 PM_\n\n---\n\nIn case the iterable shrinks in the meantime, the result of the class-accepting version of `Iterables.toArray`&nbsp;may contain nulls at its end.\n\nThe documentation says \"return a newly-allocated array into which all the elements of the iterable have been copied\", which actually doesn't prevent this. However, nobody expects `Iterables.toArray(a_not_null_allowing_set, some_class)`&nbsp;to contain several nulls.\n\nIn case you don't want to fix it, the documentation should state this very explicitly. Note that the other overload works fine.\n\nThe fix is trivial, just pass an empty array in place of the presized one. The only cost is the allocation of the empty array. A test is attached.\n", "fixed_time": "2015-10-09T18:46:38", "label": [1], "files": ["guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/Iterables.java", "guava/src/com/google/common/collect/Iterables.java"], "title": "Iterables.toArray broken in case of concurrent modifications"}, "2996": {"body": "Using `guava-23.0` (and earlier versions), `com.google.common.io.MultiInputStream` produces a stack overflow when it is given sufficiently many empty `ByteSource` instances.\r\n\r\nTest cases that reproduce the behavior:\r\n\r\n```java\r\nimport java.io.InputStream;\r\nimport java.util.List;\r\n\r\nimport org.junit.Before;\r\nimport org.junit.Test;\r\n\r\nimport com.google.common.collect.Lists;\r\nimport com.google.common.io.ByteSource;\r\n\r\npublic class MultiInputStreamTest {\r\n\r\n  /** Adjust this according to the thread stack size. */\r\n  private static final int LARGE_ENOUGH_FOR_CURRENT_STACK_SIZE = 1000000;\r\n\r\n  private ByteSource       concatenated;\r\n\r\n  public @Before void setup() throws Exception {\r\n    final List<ByteSource> emptySources = Lists.newArrayList();\r\n    for (int i = 0; i < LARGE_ENOUGH_FOR_CURRENT_STACK_SIZE; i++) {\r\n      emptySources.add(ByteSource.empty());\r\n    }\r\n    // produce a ConcatenatedByteSource which in turn produces\r\n    // a MultiInputStream\r\n    concatenated = ByteSource.concat(emptySources);\r\n  }\r\n\r\n  public @Test void stackOverflowErrorOnEmptySources1() throws Exception {\r\n    try (InputStream in = concatenated.openStream()) {\r\n      in.read();\r\n    }\r\n  }\r\n\r\n  public @Test void stackOverflowErrorOnEmptySources2() throws Exception {\r\n    try (InputStream in = concatenated.openStream()) {\r\n      in.read(new byte[1], 0, 1);\r\n    }\r\n  }\r\n\r\n}\r\n```\r\n\r\nThe condensed exception stack traces produced by the respective test case (which appear to be truncated):\r\n\r\n```\r\n$ uniq -c stack1\r\n   1 java.lang.StackOverflowError\r\n   1 \tat com.google.common.io.ByteSource$ByteArrayByteSource.openStream(ByteSource.java:574)\r\n   1 \tat com.google.common.io.MultiInputStream.advance(MultiInputStream.java:65)\r\n   1 \tat com.google.common.io.MultiInputStream.read(MultiInputStream.java:89)\r\n1021 \tat com.google.common.io.MultiInputStream.read(MultiInputStream.java:90)\r\n```\r\n\r\n```\r\n$ uniq -c stack2\r\n   1 java.lang.StackOverflowError\r\n   1 \tat com.google.common.io.MultiInputStream.close(MultiInputStream.java:52)\r\n   1 \tat com.google.common.io.MultiInputStream.advance(MultiInputStream.java:63)\r\n   1 \tat com.google.common.io.MultiInputStream.read(MultiInputStream.java:102)\r\n1021 \tat com.google.common.io.MultiInputStream.read(MultiInputStream.java:103)\r\n```", "fixed_time": "2017-11-27T19:15:07", "label": [7], "files": ["android/guava-tests/test/com/google/common/io/MultiInputStreamTest.java", "android/guava/src/com/google/common/io/MultiInputStream.java", "guava-tests/test/com/google/common/io/MultiInputStreamTest.java", "guava/src/com/google/common/io/MultiInputStream.java"], "title": "MultiInputStream produces stack overflow"}, "2410": {"body": "The second sentence of the JavaDoc for `CharMatcher.matchesNoneOf` is not correct: \"The default implementation iterates over the sequence, invoking matches(char) for each character, until this returns false or the end is reached.\"  This should be \"until this returns true or the end is reached\".  It appears the incorrect line may have been copied from `CharMatcher.matchesAllOf`\n\nSimilarly, the \"returns\" section currently says: \"true if this matcher matches every character in the sequence, including when the sequence is empty\" (same as `matchesAllOf`). It should say something like \"true if this matches matches no character in the sequence, including when the sequence is empty\".\n", "fixed_time": "2016-03-05T17:24:22", "label": [2], "files": ["guava/src/com/google/common/base/CharMatcher.java"], "title": "CharMatcher.matchesNoneOf JavaDoc is incorrect"}, "2108": {"body": "My multithreaded thrashing tests failed with Guava due to `size()` returning a negative value. The size is used for verifying that the `toArray()` methods are threadsafe (this was a common bug until JDK6 rewrote AbstractCollection's to be tolerant to races). The lines in question are,\n\n``` java\n(cache, key) -> cache.asMap().keySet().toArray(new Object[cache.asMap().size()]),\n(cache, key) -> cache.asMap().values().toArray(new Object[cache.asMap().size()]),\n(cache, key) -> cache.asMap().entrySet().toArray(new Entry[cache.asMap().size()]),\n```\n\nThis results in a `NegativeArraySizeException` unless worked around using `Math.max(0, cache.asMap().size())` which is now done in the guava fixture. I'm not sure why this occurs, and only happened after tweaking some JVM args. Regardless this failure was reproducible and is simple to fix.\n\n```\njava.lang.NegativeArraySizeException\nat com.github.benmanes.caffeine.cache.MultiThreadedTest.lambda$new$280(MultiThreadedTest.java:142)\nat com.github.benmanes.caffeine.cache.MultiThreadedTest$$Lambda$29/584234975.accept(Unknown Source)\nat com.github.benmanes.caffeine.testing.Threads$Thrasher.run(Threads.java:149)\nat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\nat com.github.benmanes.caffeine.testing.ConcurrentTestHarness.lambda$timeTasks$344(ConcurrentTestHarness.java:100)\nat com.github.benmanes.caffeine.testing.ConcurrentTestHarness$$Lambda$61/1027825150.run(Unknown Source)\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\nat java.lang.Thread.run(Thread.java:745)\n```\n", "fixed_time": "2015-07-30T19:49:13", "label": [1], "files": ["guava/src/com/google/common/cache/LocalCache.java"], "title": "Cache.asMap().size() may return a negative value"}, "2379": {"body": "Previously we at least showed [the `@GwtIncompatible` reason in the Javadoc](http://google.github.io/guava/releases/19.0/api/docs/com/google/common/util/concurrent/Futures.html#catching%28com.google.common.util.concurrent.ListenableFuture, java.lang.Class, com.google.common.base.Function%29). But this will be going away in 20.0 with the removal of `@GwtIncompatible` reasons.\n\nFurthermore, even _with_ the reason, I saw multiple people who were confused.\n\nThere are various directions we could go here, including removing `@GwtIncompatible` (by adding a manual emulation to `Futures.java` ). But I'm wondering if, whichever direction we go, we pretty much need to start the Javadoc with **This is available under GWT, but you need to pass `Throwable.class` specifically.**\n", "fixed_time": "2016-03-16T19:17:50", "label": [2], "files": ["guava/src/com/google/common/util/concurrent/Futures.java", "guava/src/com/google/common/util/concurrent/Partially.java"], "title": "Better documentation of Futures.catching GWT availability"}, "2258": {"body": "Mutable operations on `ImmutableRangeSet` (`add`, `remove`, `clear`, etc) should be marked as unsupported and deprecated and javadoc modified appropriately, in a similar way to mutable operations on the other immutable collections.\n", "fixed_time": "2015-12-21T21:31:19", "label": [2], "files": ["guava/src/com/google/common/collect/ImmutableRangeMap.java", "guava/src/com/google/common/collect/ImmutableRangeSet.java"], "title": "Mutable operations on ImmutableRangeSet should be deprecated"}, "2418": {"body": "See a unit test demonstrating the issue here: https://github.com/gpanther/fastutil-guava-tests/blob/master/src/test/java/net/greypanther/guava/tests/tests/CustomToStringTest.java\n\nIt shows a HashMap subclass which overrides toString and as a result fails tests, even if CollectionFeature.NON_STANDARD_TOSTRING passed to MapTestSuiteBuilder.\n\nI believe that methods like https://github.com/google/guava/blob/2cd4d629a2b6f1a462643b248e0972f44c5133b7/guava-testlib/src/com/google/common/collect/testing/testers/MapToStringTester.java#L45 should be marked with `@CollectionFeature.Require(absent = NON_STANDARD_TOSTRING)`.\n", "fixed_time": "2016-03-18T18:12:39", "label": [1], "files": ["guava-testlib/src/com/google/common/collect/testing/google/MultimapToStringTester.java", "guava-testlib/src/com/google/common/collect/testing/testers/MapToStringTester.java"], "title": "Map tests assert on .toString even when CollectionFeature.NON_STANDARD_TOSTRING is specified"}, "2376": {"body": "`Range.toString()` returns `U+2025` which is not supported by the default terminal under Windows, and most IDEs unless you explicitly change the font. If you read through https://issues.apache.org/jira/browse/SUREFIRE-1220 you will understand the insane hoops that developers have to jump through to get this to work.\n\nConsider replacing this unicode character by `..` or `-` or `,` ASCII characters.\n", "fixed_time": "2016-02-17T14:58:12", "label": [1], "files": ["guava-tests/test/com/google/common/collect/RangeTest.java", "guava/src/com/google/common/collect/Range.java", "guava/src/com/google/common/collect/RangeMap.java", "guava/src/com/google/common/collect/RangeSet.java"], "title": "Consider replacing unicode character in Range.toString()"}, "2254": {"body": "Hey!\nI found that the following test will fail with a TimeoutException (the Future hangs indefinitely): \n\n``` java\n  static final int REPS = 10000;\n  @Test\n  public void hangs() throws InterruptedException, TimeoutException {\n    SettableFuture<Integer> settableFuture = SettableFuture.create();\n    ListenableFuture<Integer> chained = settableFuture;\n    for (int i = 0; i < REPS; ++i) {\n      chained = Futures.transform(chained, Functions.<Integer>identity());\n    }\n    settableFuture.set(0);\n\n    Futures.get(chained, 10, TimeUnit.SECONDS, TimeoutException.class);\n  }\n```\n\nBut if I change REPS to be something smaller, like 1000 (this will depend on the size of the stack) then the test passes. I think the root cause is is that the exception can't 'surface' to the final `chained` Future due to a StackOverflowError caused by repeated DirectExecutor.execute application.\n\nMy logging config may be screwed up, but I didn't see a log for this or anything, which made finding this a bit of a chore. I checked that this happens with Guava 18 and 19. Apologies if this is a KP or already filed (I tried searching Issues, but nothing related pops up).\n", "fixed_time": "2016-01-28T13:56:56", "label": [1], "files": ["guava-gwt/test/com/google/common/util/concurrent/FuturesTest_gwt.java", "guava-tests/test/com/google/common/util/concurrent/FuturesTest.java", "guava/src/com/google/common/util/concurrent/AbstractCatchingFuture.java", "guava/src/com/google/common/util/concurrent/AbstractTransformFuture.java"], "title": "Nesting Futures.transform() eats StackOverflowError and causes the Future to hang forever"}, "2693": {"body": "Just like `java.nio.file.Files.lines()` and `java.io.BufferedReader.lines()`, for CharSource to have a `lines()` method returning a `Stream<String>` of lines.\r\n\r\nOf course this can be trivially accomplished by the caller with `charSource.openBufferedStream().lines()` and indeed a default implementation could trivially just be `return openBufferedStream().lines();`, it being the caller's responsibility to ensure the `Stream`, and thus the `Reader`, are closed; and that would be job-done for concrete implementations based on streaming sources like files, resources, URLs etc.\r\n\r\nBut a concrete `CharSource` implementation is best-placed to know if it could better override that with something more efficient than a `BufferedReader` wrapping whatever `Reader` is actually used to access the characters. For a case in point the `CharSource.CharSequenceCharSource` implementation already has a `private Iterable<String> lines()` method (which would need to be renamed, because the proposed new public method really ought to have that name, for consistency with other APIs, especially in JDK, but such a rename shouldn't have too great an impact being of a private method), which would easily be the basis of a `Stream<String> lines()` method. Say the existing private `lines()` method became `getLines()`, the implementation here would literally just be `return Streams.stream(getLines());`.\r\n\r\nFor reference my private library code that I'm hoping to replace chunks of with Guava, has a `StringLinesSpliterator` and a `CharSequenceLinesSpliterator` for these purposes, in order to get a `Stream<String>` and `Stream<CharSequence>` from such sources. The latter meaning that the subsequences aren't potentially wastefully converted to Strings; the caller can always do that themselves with `.map(String::valueOf)`. (There's also a `CharBuffer` based one, that advances the position as it goes, but honestly it doesn't get used!)\r\n\r\nAt the moment, the code that wants to get a stream of lines from the `CharSource` would have to know more than it should about the circumstances of that `CharSource`'s creation, to know if it would be least wasteful in terms of copying of character sequences of arbitrary length, or Readers wrapping Readers, to access it via `read()`, `readLines()` or `openBufferedStream()`. Instead they ought to be able to trust that the implementation of `CharSource` will do it the best way.\r\n\r\nPossibly the first in a series of missing `Stream` based conveniences, as Java8-only features are a relatively new thing in Guava. ;-)", "fixed_time": "2017-03-03T18:29:04", "label": [5], "files": ["guava-tests/test/com/google/common/io/CharSourceTest.java", "guava-tests/test/com/google/common/io/CharSourceTester.java", "guava/src/com/google/common/io/ByteSink.java", "guava/src/com/google/common/io/ByteSource.java", "guava/src/com/google/common/io/CharSink.java", "guava/src/com/google/common/io/CharSource.java", "guava/src/com/google/common/io/MoreFiles.java", "pom.xml"], "title": "Add Stream<String> lines() to CharSource"}, "2101": {"body": "When the cache is being cleared, either through `Cache.invalidateAll()` or `asMap().clear()`, the removal cause is always `EXPLICIT`. However the map may contain expired or GC'd entries that would be removed on the next maintenance cycle. The removal cause should indicate the actual state of the entry, not merely the action that triggered the eventual removal.\n\nDue to weak and soft references the key or value may be null. A listener should only expect to receive a null key or value if the cause is `COLLECTED`, as indicated by `RemovalNotification`:\n\n> The key and/or value may be null if they were already garbage collected.\n\nTherefore a listener might decide to inspect the properties without a null guard, leading to an NPE.\n\n``` java\n@Test\npublic void clear_expireAfterAccess() {\n  FakeTicker ticker = new FakeTicker();\n  RemovalListener<Integer, Integer> listener = Mockito.mock(RemovalListener.class);\n  ArgumentCaptor<RemovalNotification<Integer, Integer>> captor =\n      ArgumentCaptor.forClass(RemovalNotification.class);\n  Cache<Integer, Integer> cache = CacheBuilder.newBuilder()\n      .expireAfterAccess(1, TimeUnit.MINUTES)\n      .removalListener(listener)\n      .ticker(ticker)\n      .build();\n  cache.put(1, 1);\n  ticker.advance(10, TimeUnit.MINUTES);\n  cache.invalidateAll();\n\n  verify(listener).onRemoval(captor.capture());\n  assertThat(captor.getValue().getCause(), is(RemovalCause.EXPIRED));\n}\n```\n\nThe fix is to change `LocalCache$Segment#clear()` to inspect the key, value, and expiration status when determining the cause. \n\nUnfortunately this race condition is more widespread due to `enqueueNotification` not being tolerant to a garbage collection nulling out the key/value. Prior to constructing the notification, the method must take a strong reference to the key and value, check if either was collected, and if so publish a `COLLECTED` instead of the caller's cause.\n", "fixed_time": "2015-11-30T22:26:14", "label": [1], "files": ["guava-tests/test/com/google/common/cache/CacheExpirationTest.java", "guava/src/com/google/common/cache/LocalCache.java"], "title": "Wrong RemovalCause published on cache.invaldateAll()"}, "1001": {"body": "_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1001) created by **kevinb@google.com** on 2012-05-11 at 04:32 PM_\n\n---\n\nNow that Guava requires JDK 6, we can probably reimplement Sets.newSetFromMap as a pass-through to Collections.newSetFromMap(), and deprecate it.  However,\n\n(a) no sense doing that until after the backport is worked out, and\n\n(b) I don't think we can do the usual \"schedule for deletion in 18 months\" thing. For the time being, I think we need to ensure that the relationship between guava and guava5 is that of a purely compatible superset. Otherwise libraries that build against guava5 in order to be available to their JDK 5 users may break when used by JDK 6 users (who use guava instead of guava5).\n\nNot sure for which other libraries we might have a similar situation.\n", "fixed_time": "2015-10-16T01:03:59", "label": [0], "files": ["guava-gwt/src-super/com/google/common/collect/super/com/google/common/collect/Sets.java", "guava/src/com/google/common/collect/Sets.java"], "title": "Reimplement and deprecate Sets.newSetFromMap (but no removing it)"}}